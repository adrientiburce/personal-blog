<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Unit Testing : from PhpUnit to Coverage Report</title><style>html body{font-family:raleway,sans-serif;background-color:#fff}:root{--accent:#822337;--border-width:5px}</style><link rel=stylesheet href=https://adrien-blog.netlify.app/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/solarized-dark.min.css><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js></script><script>hljs.initHighlightingOnLoad()</script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script>$(document).on('click',function(){$('.collapse').collapse('hide')})</script><meta name=generator content="Hugo 0.85.0"><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></head><body><nav class="navbar navbar-default navbar-fixed-top"><div class=container><div class=navbar-header><a class="navbar-brand visible-xs" href=#>Unit Testing : from PhpUnit to Coverage Report</a>
<button class=navbar-toggle data-target=.navbar-collapse data-toggle=collapse>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><a href=/project/>Projects</a></li><li><a href=https://developer.webrush.fr>Notes</a></li><li><a href=/about/>About</a></li></ul><ul class="nav navbar-nav navbar-right"><li class=navbar-icon><a href=https://github.com/adrientiburce/><i class="fab fa-github"></i></a></li><li class=navbar-icon><a href=https://www.linkedin.com/in/adrientiburce-centralelille><i class="fab fa-linkedin"></i></a></li><li class=navbar-icon><a href=https://stackoverflow.com/users/11619849/a-ecrubit><i class="fab fa-stack-overflow"></i></a></li></ul></div></div></nav><main><div><h2>Unit Testing : from PhpUnit to Coverage Report</h2><h5>July 22, 2020</h5><a href=https://adrien-blog.netlify.apptags/php><kbd class=item-tag>php</kbd></a>
<a href=https://adrien-blog.netlify.apptags/phpunit><kbd class=item-tag>phpunit</kbd></a>
<a href=https://adrien-blog.netlify.apptags/testing><kbd class=item-tag>testing</kbd></a></div><div align=start class=content><p>If you want to be confident each time you add a new functionality in your code, or when you need to change some old code of your application unit tests are a necessity. In this article, I will not try to convince the few (I hope) developers reticent with unit testing but rather showing you how to implement it without hustles.</p><hr><h1 id=1-installing-our-tools>1. Installing our tools</h1><ul><li><a href=https://phpunit.de/><strong>PhpUnit</strong></a> : it will run all our tests</li></ul><p>On a Symfony project simply run <code>composer require â€” dev symfony/phpunit-bridge</code></p><ul><li><a href=https://xdebug.org/><strong>Xdebug</strong></a> : it will run our tests and generate a coverage report on our code.</li></ul><hr><h1 id=2-running-our-tests>2. Running our tests</h1><h2 id=configuration>Configuration</h2><p>Add a <code>phpunit.xml</code> file at the root of your project :</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;phpunit</span> <span style=color:#a6e22e>colors=</span><span style=color:#e6db74>&#34;true&#34;</span><span style=color:#f92672>&gt;</span>
    <span style=color:#f92672>&lt;testsuites&gt;</span>
        <span style=color:#f92672>&lt;testsuite</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;Manager Test Suite&#34;</span><span style=color:#f92672>&gt;</span>
            <span style=color:#f92672>&lt;directory&gt;</span>./Tests<span style=color:#f92672>&lt;/directory&gt;</span>
        <span style=color:#f92672>&lt;/testsuite&gt;</span>
    <span style=color:#f92672>&lt;/testsuites&gt;</span>
<span style=color:#f92672>&lt;/phpunit&gt;</span>
</code></pre></div><p>In order to get color highlight in our terminal we can configure our <code>phpunit.xml</code> with the<code>colors="true"</code>option.</p><h2 id=get-the-results>Get the results</h2><ul><li>Run <strong>all our test</strong> : <code>./bin/phpunit</code></li><li>Running <strong>only a directory</strong> : <code>./bin/phpunit Tests/Manager</code></li><li>Running <strong>only one test</strong> :<code>./bin/phpunit Tests/AmountTest.php --filter=testTotalAmount</code></li></ul><p><img src=https://cdn.hashnode.com/res/hashnode/image/upload/v1598105143730/2-SRlshbc.png alt="result colored"></p><p>Result of our tests</p><hr><h1 id=3-code-coverage>3. Code Coverage</h1><p>Now that we test our codebase and see which tests are failing, we can go further. Once all our tests are green we need to know what we should test next. Or which tests are too weak.</p><h2 id=configuration-1>Configuration</h2><p>Add a <code>phpunit.coverage.xml</code> file at the root of your project :</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;phpunit</span> <span style=color:#a6e22e>colors=</span><span style=color:#e6db74>&#34;true&#34;</span><span style=color:#f92672>&gt;</span>
    <span style=color:#f92672>&lt;testsuites&gt;</span>
        <span style=color:#f92672>&lt;testsuite</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;Manager test suites&#34;</span><span style=color:#f92672>&gt;</span>
            <span style=color:#f92672>&lt;directory&gt;</span>./Tests/Manager<span style=color:#f92672>&lt;/directory&gt;</span>
        <span style=color:#f92672>&lt;/testsuite&gt;</span>
    <span style=color:#f92672>&lt;/testsuites&gt;</span>
    <span style=color:#f92672>&lt;logging&gt;</span>
        <span style=color:#f92672>&lt;log</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;coverage-html&#34;</span>
             <span style=color:#a6e22e>target=</span><span style=color:#e6db74>&#34;./log/codeCoverage&#34;</span>
             <span style=color:#a6e22e>lowUpperBound=</span><span style=color:#e6db74>&#34;40&#34;</span>
             <span style=color:#a6e22e>highLowerBound=</span><span style=color:#e6db74>&#34;75&#34;</span>
             <span style=color:#a6e22e>showUncoveredFiles=</span><span style=color:#e6db74>&#34;false&#34;</span><span style=color:#f92672>/&gt;</span>
    <span style=color:#f92672>&lt;/logging&gt;</span>
    <span style=color:#f92672>&lt;filter&gt;</span>
<span style=color:#75715e>&lt;!--        files with at least one line executed appears in report--&gt;</span>
        <span style=color:#f92672>&lt;whitelist</span> <span style=color:#a6e22e>addUncoveredFilesFromWhitelist=</span><span style=color:#e6db74>&#34;false&#34;</span><span style=color:#f92672>&gt;</span>
            <span style=color:#f92672>&lt;directory</span> <span style=color:#a6e22e>suffix=</span><span style=color:#e6db74>&#34;.php&#34;</span><span style=color:#f92672>&gt;</span>./Manager<span style=color:#f92672>&lt;/directory&gt;</span>
        <span style=color:#f92672>&lt;/whitelist&gt;</span>
    <span style=color:#f92672>&lt;/filter&gt;</span>
<span style=color:#f92672>&lt;/phpunit&gt;</span>
</code></pre></div><p>You can now change phpunit options as you want :</p><ul><li><p><code>&lt;testsuites></code> : which tests will be executed</p></li><li><p><code>&lt;logging></code> : configure code coverage info.</p><ul><li><em>lowUpperBound</em> which percentage code should be covered to be regarded as low</li><li><em>highUpperBound</em> : minimum percentage for high coverage</li></ul></li></ul><p></p><ul><li><p><code>&lt;filter></code> : specify which files will be included in the code coverage report</p></li><li><p><code>&lt;whitelist></code> : specify which files are being included using following options :</p><ul><li><code>addUncoveredFilesFromWhitelist="false"</code> to only show files executed by the test in the report</li><li><code>processUncoveredFilesFromWhitelist="false"</code> all files are added to the report</li></ul></li></ul><h2 id=report>Report</h2><p>Run this to see the generated coverage report : <code>/.bin/phpunit -c phpunit.coverage.xml</code></p><p>Using the previous configuration, this command will run our tests again but thanks to <strong>Xdebug</strong> it will generate an html report.</p><p></p><p><img src=https://cdn.hashnode.com/res/hashnode/image/upload/v1598105158184/lox1rHYDh.png alt="code report"></p><p>The html coverage report can now be found at the <code>target</code> location configured in our <code>phpunit.coverage.xml</code> , in our case : <code>.log/codeCoverage</code></p></div><h4 class=page-header>Comments</h4><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//username.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></main><footer><p class="copyright text-muted">Â© All rights reserved. Powered by <a href=https://gohugo.io>Hugo</a> and <a href=https://github.com/calintat/minimal>Minimal</a>.</p></footer></body></html>